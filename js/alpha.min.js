/*!
 * SkiCycleRun v4.0.0-alpha (https://skicyclerun.com)
 * Copyright 2018 - SkiCycleRun2019 Feo ElGato
 * Licensed under MIT repository git+https://github.com/timothyhalley/skicyclerun.git
 */
if(Modernizr.eventlistener){addEventListener("touchstart",function(e){e.preventDefault()},!!Modernizr.passiveeventlisteners&&{passive:!0}),document.querySelector(".map-alpha").addEventListener("dblclick",function(e){const t="https://img.skicyclerun.com/pub/skiCycleRun/"+getRandomInt(1e4,10300)+".jpg";$(this).css("background-image",'url("'+t+'")'),console.log("DEBUG: new Background --\x3e ",t)})}else console.log("eventlistener test failed!");function getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}async function selectMap(e){var t=e.substring(e.lastIndexOf("/")+1,e.length-2),o=e.substr(0,e.lastIndexOf("/")),a=o.substring(o.lastIndexOf("/")+1).trim();const n=await getPhotoTags(a,t),s={lat:parseFloat(n.GPSLatitude),lng:parseFloat(n.GPSLongitude)};await setMap(s)}async function setMap(e){var t=new google.maps.Map(document.getElementById("map"),{zoom:16,center:e,mapTypeId:google.maps.MapTypeId.TERRAIN});new google.maps.Marker({position:e,title:"SkiCycleRun"}).setMap(t)}async function getPhotoTags(e,t){try{let o="https://api.skicyclerun.com/deadpool/getPhotoTags/pub/"+e+"/"+t,a=await fetch(o,{cache:"no-cache"});return await a.json()}catch(e){console.log("ERROR: ",e)}}async function mapLocation(e){var t=e.coords.latitude,o=e.coords.longitude;const a={lat:parseFloat(t),lng:parseFloat(o)};await setMap(a)}function errorHandler(e){1==e.code?alert("Error: Access is denied!"):2==e.code&&alert("Error: Position is unavailable!")}function getLocation(){if(navigator.geolocation){let e={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};navigator.geolocation.getCurrentPosition(mapLocation,errorHandler,e)}else alert("Sorry, browser does not support geolocation!")}Modernizr.geolocation?(console.log("EVENT: --\x3e getting location"),getLocation()):console.log("geolocation test failed!"),$(".grid").masonry({itemSelector:".grid-item",columnWidth:".grid-sizer",percentPosition:!0}),$(".grid-item").click(function(e){if(console.log("DEBUG: grid-item --\x3e clicked"),$(this).hasClass("item-opened"))console.log("DEBUG: YES has class --\x3e item-opened"),$(".grid").css("overflow","hidden"),$("html, body").animate({scrollTop:$("#map").offset().top},1200);else{console.log("DEBUG: !NOT has class --\x3e item-opened");$(this).outerWidth();var t=this.getBoundingClientRect();$(this).attr("data-coord-left",$(this).css("left")),$(this).attr("data-coord-top",$(this).css("top")),selectMap($(this).css("background-image")),$(this).css({top:t.top,left:t.left}).delay(400).css({top:"120px",left:"10%",zIndex:"99999"}).addClass("item-opened"),$(".grid-alpha").fadeIn(),$(".map-alpha").delay(600).css({top:"0px",left:"0%",height:"100vw",zIndex:"99998"}).addClass("item-opened"),$("#map").css({top:"100vw",height:"100%"}),$("#map").fadeIn(),$(".map-alpha").css({"background-image":"linear-gradient(rgba(0, 0, 255, 0.5), rgba(255, 255, 0, 0.5)"}),$(".map-alpha").fadeIn(),$("html, body").animate({scrollTop:$(".grid").offset().top},650),$(".grid").css("overflow","visible")}}),$(document).on("click",function(e){$(".item-opened").length>0&&($(e.target).closest(".grid-item").length||$(e.target).hasClass("item-opened")||($(".grid-alpha").fadeOut(650),$(".map-alpha").fadeOut(650),$(".item-opened").css({top:$(".item-opened").data("coord-top"),left:$(".item-opened").data("coord-left"),marginLeft:""}),$("html, body").animate({scrollTop:$(".grid").offset().top+parseFloat($(".item-opened").data("coord-top"))-30},650),setTimeout(function(){$(".grid-item").css("z-index","").removeClass("item-opened")},350),$(".grid").css("overflow","hidden")));var t=$(".grid").data("masonry");t.getItemElements();t.reloadItems()});